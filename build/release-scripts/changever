#!/bin/sh
# $HeadURL:: http://gandalf/svn/head/topaz/core/src/main/java/org/topazproject/otm/Abst#$
# $Id: AbstractConnection.java 4807 2008-02-27 11:06:12Z ronald $
# 
# Copyright (c) 2007-2008 by Topaz, Inc.
# http://topazproject.org
# 
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# 
# http://www.apache.org/licenses/LICENSE-2.0
# 
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# This script needs to be run from head (or the top of a suitable branch)

# This variable is all that should be modified
toVer="0.8.3-SNAPSHOT"

# Compute the current version strings
fromVer=`groovy -e 'print new XmlSlurper().parse(new File("pom.xml")).version'`

# Find all the poms we want to update
declare -a poms
poms=(`find . -name pom.xml -print -o -name target -prune -o -name install -prune` src/site/site.xml)

echo "Updating ${#poms[@]} poms from $fromVer to $toVer"

# Verify user wants to continue
read -p "Continue (y/n)? " ans
[[ "$ans" != y* ]] && exit 1

# Update all our poms
for f in ${poms[@]}; do
  echo "Updating $f to $toVer"
  perl -p -i -e "s/\Q$fromVer/$toVer/g" "$f"
done

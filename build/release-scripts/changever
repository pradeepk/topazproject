#!/bin/sh

# This script needs to be run from head (or the top of a suitable branch)

# This variable is all that should be modified
toVer="0.8.3-SNAPSHOT"

# Compute the current version strings
fromVer=`groovy -e 'print new XmlSlurper().parse(new File("pom.xml")).version'`

# Find all the poms we want to update
declare -a poms
poms=(`find . -name pom.xml -print -o -name target -prune -o -name install -prune` src/site/site.xml)

echo "Updating ${#poms[@]} poms from $fromVer to $toVer"

# Verify user wants to continue
read -p "Continue (y/n)? " ans
[[ "$ans" != y* ]] && exit 1

# Update all our poms
for f in ${poms[@]}; do
  echo "Updating $f to $toVer"
  perl -p -i -e "s/\Q$fromVer/$toVer/g" "$f"
done

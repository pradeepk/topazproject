<?xml version="1.0" encoding="UTF-8"?>
<!--
  $HeadURL::                                                                             $
  $Id$

  Copyright (c) 2006 by Topaz, Inc.
  http://topazproject.org

  Licensed under the Educational Community License version 1.0
  http://opensource.org/licenses/ecl1.php

  Note that mulgara-install does nothing and is only present for symmetry.
  The mulgara jar file is actually built by mulgara/mulgara-service.
-->
<project xmlns:artifact="antlib:org.apache.maven.artifact.ant">

  <target name="init">
    <property name="home" location="${DEST_DIR}/${ROOT}"/>
    <property name="port" value="${PORT}"/>
  </target>

  <target name="jar">
    <artifact:dependencies filesetId="mulgara.fileset" useScope="runtime">
      <dependency groupId="org.topazproject" artifactId="mulgara-service"
                  version="${jarVersion}" type="jar"/>
    </artifact:dependencies>
    <pathconvert property="mulgara-jar" refid="mulgara.fileset"/>
  </target>

  <!-- A no-op -->
  <target name="mulgara-install" depends="init">
  </target>

  <!-- Clean out the whole mulgara directory -->
  <target name="mulgara-uninstall" depends="init">
    <delete dir="${home}"/>
  </target>

  <!-- Start mulgara -->
  <target name="mulgara-start" depends="init,jar">
    <echo>Starting Mulgara (spawn=${SPAWN})</echo>

    <property name="topaz.mulgara.databaseDir" location="${home}/database"/>

    <condition property="failonerr" value="true" else="false">
      <isfalse value="${SPAWN}"/>
    </condition>

    <echo message="Starting Mulgara..."/>
    <echo message="Using home    = ${home}"/>
    <echo message="Using jar     = ${mulgara-jar}"/>
    <echo message="Using port    = ${port}"/>
    <echo message="Using dbdir   = ${topaz.mulgara.databaseDir}"/>
    <echo message="Use -Dtopaz.mulgara.databaseDir to specify specific DB"/>
    <echo message="Use -Dlog4j.configuration=file:///..location.. to specify log4j config"/>

    <mkdir dir="${home}"/>

    <java jar="${mulgara-jar}" fork="true" spawn="${SPAWN}" failonerror="${failonerr}"
          dir="${home}">
      <jvmarg line="${jvmargs}"/>
      <arg value="-s"/>
      <arg value="topazproject"/>
      <arg value="-a"/>
      <arg file="${topaz.mulgara.databaseDir}"/>
      <syspropertyset>
        <propertyref prefix="topaz."/>
        <propertyref prefix="log4j."/>
        <propertyref prefix="com."/>
      </syspropertyset>
    </java>
  </target>

  <!-- Stop mulgara -->
  <target name="mulgara-stop" depends="init,jar">
    <echo>Stopping Mulgara</echo>

    <java jar="${mulgara-jar}" fork="true" failonerror="true" dir="${home}">
      <arg value="-s"/>
      <arg value="topazproject"/>
      <arg value="-x"/>
    </java>
  </target>
    
</project>

<!DOCTYPE xwork PUBLIC "-//OpenSymphony Group//XWork 1.1.1//EN" "http://www.opensymphony.com/xwork/xwork-1.1.1.dtd">
<!--
  - Copyright (c) 2006 by Topaz, Inc.
  - http://topazproject.org
  -
  - Licensed under the Educational Community License version 1.0
  - http://opensource.org/licenses/ecl1.php
  -->
<xwork>
  <include file="webwork-default.xml" />

  <package name="default" extends="webwork-default">
    <result-types>
      <result-type name="freemarker"
        class="com.opensymphony.webwork.views.freemarker.FreemarkerResult" default="true">
      </result-type>
      <result-type name="plosOneFreemarker"
        class="org.plos.webwork.PlosOneFreemarkerResult">
        <param name="location">/templates/main_template.ftl</param>
      </result-type>
      <result-type name="plosStream" class="org.plos.webwork.PlosStreamResult" />
      <result-type name="ajaxJSON" class="com.opensymphony.webwork.result.AjaxJSONResult" />
    </result-types>

    <interceptors>
      <interceptor name="ensureUserAccount" class="org.plos.user.EnsureUserAccountInterceptor"/>

      <interceptor-stack name="plosBaseStack">
        <interceptor-ref name="timer" />
        <interceptor-ref name="logger"/>
        <interceptor-ref name="defaultStack" />
      </interceptor-stack>

      <interceptor-stack name="plosUserStack">
        <interceptor-ref name="plosBaseStack" />
        <interceptor-ref name="ensureUserAccount" />
      </interceptor-stack>
    </interceptors>

    <default-interceptor-ref name="plosUserStack" />

    <default-action-ref name="home" />

    <global-results>
      <result name="new-profile" type="redirect-action">
        <param name="actionName">prePopulateNewUser</param>
        <param name="namespace">/user/create</param>
      </result>
      <result name="update-profile" type="redirect-action">
        <param name="actionName">prePopulateNewUser</param>
        <param name="namespace">/user/create</param>
      </result>
    </global-results>

    <action name="logout" class="org.plos.action.LogoutAction">
      <result type="redirect">/</result>
    </action>

    <action name="home">
      <result>/WEB-INF/pages/todo.ftl</result>
    </action>

	  <action name="testFreemarker">
      <result name="success" type="plosOneFreemarker">
        <param name="templateFile">/WEB-INF/pages/include.ftl</param>
      </result>
    </action>

    <action name="register" class="org.plosone.action.RegistrationAction">
      <!--<result name="success">/WEB-INF/pages/home.ftl</result>-->
      <result type="chain">home</result>
    </action>
  </package>

  <package name="article" extends="default" namespace="/article">
    <action name="articleList" class="org.plos.article.action.ArticleListAction">
      <result name="success">/WEB-INF/pages/article/articleList.ftl</result>
    </action>

    <action name="fetchArticle" class="org.plos.article.action.FetchArticleAction">
      <result name="success" type="plosOneFreemarker">
        <param name="templateFile">/article/article_body.ftl</param>
      </result>
      <result name="error">/WEB-INF/pages/error.ftl</result>
    </action>

    <action name="fetchSecondaryObjects" class="org.plos.article.action.SecondaryObjectAction">
      <result name="error">/WEB-INF/pages/error.ftl</result>
      <result name="success">/WEB-INF/pages/article/displayImages.ftl</result>
    </action>

    <action name="fetchObjectAttachment" class="org.plos.article.action.FetchObjectAction">
      <result name="success" type="plosStream">
        <param name="isAttachment">true</param>
      </result>
    </action>
    
    <action name="fetchObject" class="org.plos.article.action.FetchObjectAction">
      <result name="success" type="plosStream">
        <param name="isAttachment">false</param>
      </result>
    </action>
    
    <action name="fetchAnnotatedArticle" class="org.plos.article.action.FetchArticleAction" method="getAnnotatedArticle">
       <result name="success">/WEB-INF/pages/article/displayArticle.ftl</result>
       <result name="error">/WEB-INF/pages/error.ftl</result> 
    </action>
    
    <action name="fetchBody" class="org.plos.article.action.FetchArticleAction">
      <result name="error">/WEB-INF/pages/error.ftl</result> 
      <result name="success">/article/article_content.ftl</result>
    </action>
  </package>

  <package name="annotation" extends="default" namespace="/annotation">
    <action name="fetchBody" class="org.plos.annotation.action.BodyFetchAction">
      <result name="success">/WEB-INF/pages/annotation/showCommentBody.ftl</result>
    </action>

    <action name="listAnnotation" class="org.plos.annotation.action.ListAnnotationAction">
      <result name="success">/WEB-INF/pages/annotation/listAnnotation.ftl</result>
    </action>

    <action name="getAnnotation" class="org.plos.annotation.action.GetAnnotationAction">
      <result name="success" type="ajaxJSON"/>
    </action>

    <action name="listReply" class="org.plos.annotation.action.ListReplyAction">
      <result name="success">/WEB-INF/pages/annotation/listReply.ftl</result>
    </action>

    <action name="listAllReplies" class="org.plos.annotation.action.ListReplyAction"
      method="listAllReplies">
      <result name="success">/WEB-INF/pages/annotation/listReply.ftl</result>
    </action>

    <action name="listThreadedReplies" class="org.plos.annotation.action.ListReplyAction"
      method="listAllReplies">
      <result name="success">/WEB-INF/pages/annotation/listThreadedReply.ftl</result>
    </action>

    <action name="listThread" class="org.plos.annotation.action.ListReplyAction" method="listAllReplies">
      <result name="success" type="plosOneFreemarker">
        <param name="templateFile">/discussion/threaded_replies.ftl</param>
      </result>
      <result name="error">/WEB-INF/pages/error.ftl</result>
    </action>

    <action name="listThreadRefresh" class="org.plos.annotation.action.ListReplyAction" method="listAllReplies">
      <result name="success">/discussion/threaded_replies.ftl</result>
      <result name="error">/WEB-INF/pages/error.ftl</result>
    </action>



    <action name="getReply" class="org.plos.annotation.action.GetReplyAction">
      <result name="success" type="ajaxJSON"/>
    </action>

    <action name="listFlags" class="org.plos.annotation.action.ListFlagAction">
      <result name="success">/WEB-INF/pages/annotation/listFlag.ftl</result>
    </action>

    <action name="getFlag" class="org.plos.annotation.action.GetFlagAction">
      <result name="success" type="ajaxJSON"/>
    </action>
  </package>

  <package name="annotation-secure" extends="default" namespace="/annotation/secure">
    <action name="createAnnotation">
      <result>/WEB-INF/pages/annotation/createAnnotation.ftl</result>
    </action>

    <action name="createAnnotationSubmit" class="org.plos.annotation.action.CreateAnnotationAction">
      <result name="input" type="ajaxJSON"/>
      <result name="error" type="ajaxJSON"/>
      <result name="success" type="ajaxJSON"/>
    </action>

    <action name="deletePrivateAnnotation" class="org.plos.annotation.action.DeleteAnnotationAction" method="deletePrivateAnnotation">
      <result name="success" type="redirect">/home.action</result>
    </action>

    <action name="deletePublicAnnotation" class="org.plos.annotation.action.DeleteAnnotationAction" method="deletePublicAnnotation">
      <result name="success" type="redirect">/home.action</result>
    </action>

    <action name="createReplySubmit" class="org.plos.annotation.action.CreateReplyAction">
      <result name="input" type="ajaxJSON"/>
      <result name="error" type="ajaxJSON"/>
      <result name="success" type="ajaxJSON"/>
    </action>

    <action name="deleteReply" class="org.plos.annotation.action.DeleteReplyAction" method="deleteReplyWithId">
      <result name="success" type="redirect">/home.action</result>
    </action>

    <!--TODO: not needed ?? -->
    <action name="createFlag">
      <result>/WEB-INF/pages/annotation/createFlag.ftl</result>
    </action>

    <action name="createAnnotationFlagSubmit" class="org.plos.annotation.action.CreateFlagAction" method="createAnnotationFlag">
      <result name="input" type="ajaxJSON"/>
      <result name="error" type="ajaxJSON"/>
      <result name="success" type="ajaxJSON"/>
    </action>

    <action name="createReplyFlagSubmit" class="org.plos.annotation.action.CreateFlagAction" method="createReplyFlag">
      <result name="input" type="ajaxJSON"/>
      <result name="error" type="ajaxJSON"/>
      <result name="success" type="ajaxJSON"/>
    </action>

    <action name="deleteFlag" class="org.plos.annotation.action.DeleteFlagAction">
      <result name="success" type="redirect">/home.action</result>
    </action>

    <action name="unflagAnnotation" class="org.plos.annotation.action.UnflagAnnotationAction" method="unflagAnnotation">
      <result name="success" type="redirect">/home.action</result>
    </action>

    <action name="unflagReply" class="org.plos.annotation.action.UnflagAnnotationAction" method="unflagReply">
      <result name="success" type="redirect">/home.action</result>
    </action>

  </package>

  <package name="user-secure" extends="default" namespace="/user/secure">
    <action name="displayUser" class="org.plos.user.action.DisplayUserAction">
      <result name="success">/WEB-INF/pages/user/displayUser.ftl</result>
    </action>
    
    <action name="secureRedirect" class="org.plos.action.RedirectAction">
      <result type="redirect">${goTo}</result>
    </action>

    <action name="getUserProfilePrivateFields" class="org.plos.user.action.DisplayUserAction" method="fetchUserProfileWithPrivateVisibility">
      <result name="success">/WEB-INF/pages/user/displayPrivateFieldNames.ftl</result>
    </action>

    <action name="assignAdminRole">
      <result>/WEB-INF/pages/user/assignAdminRole.ftl</result>
    </action>

    <action name="assignAdminRoleSubmit" class="org.plos.user.action.AssignAdminRoleAction" method="assignAdminRole">
      <result name="success" type="redirect">/home.action</result>
      <result name="error" type="ajaxJSON"/>
    </action>

    <action name="assignAdminRoleToSubmit" class="org.plos.user.action.AssignAdminRoleAction">
      <result name="success" type="redirect">/home.action</result>
      <result name="error" type="ajaxJSON"/>
    </action>

    <action name="retrieveUserAlerts" class="org.plos.user.action.UserAlertsAction" method="retrieveAlerts">
      <result name="success">/WEB-INF/pages/user/alerts.ftl</result>
      <result name="error">/WEB-INF/pages/user/alerts.ftl</result>
      <result name="input">/WEB-INF/pages/user/alerts.ftl</result>
    </action>

    <action name="saveUserAlerts" class="org.plos.user.action.UserAlertsAction" method="saveAlerts">
      <result name="success">/WEB-INF/pages/user/alerts.ftl</result>
      <result name="error">/WEB-INF/pages/user/alerts.ftl</result>
      <result name="input">/WEB-INF/pages/user/alerts.ftl</result>
    </action>
  </package>

  <package name="user-creation" extends="default" namespace="/user/create">
    <default-interceptor-ref name="plosBaseStack" />
    <action name="newUser">
      <result>/WEB-INF/pages/user/newUser.ftl</result>
    </action>

    <action name="prePopulateNewUser" class="org.plos.user.action.PrepopulateUserDetailsAction">
      <result name="new-profile">/WEB-INF/pages/user/newUser.ftl</result>
      <result name="update-profile">/WEB-INF/pages/user/newUser.ftl</result>
    </action>

    <action name="createNewUser" class="org.plos.user.action.CreateUserAction">
      <result name="success">/WEB-INF/pages/user/newUserCreated.ftl</result>
      <result name="input">/WEB-INF/pages/user/newUser.ftl</result>
    </action>
  </package>
  
  <package name="admin" extends="default" namespace="/admin">
  	<action name="adminTop">
  		<result>/WEB-INF/pages/admin/adminTop.ftl</result>
  	</action>
  	<action name="multiFileIngest" class="org.plos.admin.action.MultiFileIngestAction">
  	  	<result name="success">/WEB-INF/pages/admin/adminTop.ftl</result>
  	  	<result name="error">/WEB-INF/pages/admin/adminTop.ftl</result>  	  	
  	</action> 	
  </package>

</xwork>

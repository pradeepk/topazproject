<?xml version="1.0" encoding="UTF-8" ?>
<!--
  $HeadURL::                                                                                      $
  $Id$

  Copyright (c) 2006 by Topaz, Inc.
  http://topazproject.org

  Licensed under the Educational Community License version 1.0
  http://opensource.org/licenses/ecl1.php

  This is the defaults used by any plos associated webapp and/or command line utility.
  The ConfigurationStore singleton loads this first. Settings in the defaults.xml
  resource in libs and webapps that use ConfigurationStore take precedence and
  override all the settings here. Although normally stuff in defaults.xml simply
  suplements these settings and it is what is in /etc that overrides these.

  Please see the ConfigImplementation wiki page for more information.
-->
<config>
  <network>
    <!-- This network section defines the hosts and ports used to talk to the services
         the publishing system uses.

         Note to developers: Please do not use anything from the network section directly
         in code. Instead define something in your own namespace and reference that. Doing
         so allows more flexibility if re-factoring the network topology later.

         With the exception of the "webhead", most services run as web-applications within
         a J2EE container (usually tomcat). Multiple containers can run on the same host
         by listening on different ports. In fact, the default configuration is to run
         each container on different ports regardless so that additional configuration
         change is not required when running containers separately or on the same host.
         The publishing system uses the following web-applications:
          * cas          - Handles user authentication for the publishing system
          * registration - Registers and logs in users (usually runs in the same
                           container that cas runs in.
          * fedora       - The blob store used to store ingested articles
          * mulgara      - The tripple store. (Currently uses axis over http, but will
                           change to run as a stand-alone rmi server in the future)
          * plosone      - The publishing system
          * search       - The lucene full-text search engine. (No configuration in the
                           network section yet. Shares the plosone container.)
          * doi-resolver - Resolves DOIs. (Also no configuration here yet. Shares
                           plosone container.)
          * default      - This is the webhead that runs apache. See wiki for more info.
          * mailhost     - The machine to send mail via. Usually just localhost if a
                           mail server is running.
    -->
    <hosts>
      <!-- Set hosts.default to FQHN (not localhost) if installing all components on one host
           (or to webhead FQHN for multiple host installation) -->
      <default>localhost</default>
      <mailhost>localhost</mailhost>
      <!-- For multibox install, change the following entires to the appropriate FQHNs -->
      <cas>${network.hosts.default}</cas>
      <registration>${network.hosts.cas}</registration>
      <fedora>${network.hosts.default}</fedora>
      <mulgara>${network.hosts.default}</mulgara>
      <plosone>${network.hosts.default}</plosone>
      <!-- TODO: Use registration apropriately every where. Pull out doi-resolver (& search?) -->
    </hosts>
    <ports>
      <!-- There are 4 protocols that the publishing system uses:
            * http    - The default protocol
            * TLS/SSL - When communication needs to be secure
            * RMI     - An java specific RPC protocol (to be uses soon)
            * mail    - The SMTP protocol

          Ports are defined as either "host-protocol" or just "host" if the protocol is http.
          If defining a port that is http, if the value would be 80, leave it blank.
          If defining a port that is https, if the value would be 443, leave it blank.
      -->
      <!-- If using port 80, set default to empty (not 80) -->
      <default>${network.ports.plosone}</default>
      <!-- If using port 443, set cas-ssl to empty -->
      <cas-ssl>7443</cas-ssl>

      <plosone>8080</plosone>
      <plosone-ssl>10443</plosone-ssl>
      <fedora>9090</fedora>
      <mulgara>9091</mulgara>

      <registration-ssl>${network.ports.cas-ssl}</registration-ssl>
    </ports>
  </network>

  <cas>
    <!-- The following entries defnine how the java webapp talk to the database.
         For example, talking to postgresql, you need the database name at the end of the url
         The user and password are for the database as well. -->
    <db>
      <user>casuser</user>
      <password>caspass</password>
      <url>jdbc:postgresql://localhost/casdb</url>
      <driver>org.postgresql.Driver</driver>
    </db>
  </cas>
    
  <topaz>
    <mulgara>
      <!-- The base uri of all the models that we create in mulgara.-->
      <baseuri>local:///topazproject</baseuri>
    </mulgara>
    <objects>
      <!-- The base uri for all objects that we create in fedora. -->
      <base-uri>info:doi/10.1371/</base-uri>
    </objects>
    <!-- The list of models in mulgara that we depend on/create -->
    <models>
      <ri type="http://topazproject.org/models#filter">${topaz.mulgara.baseuri}#filter:model=ri</ri>
      <articles type="${topaz.models.ri[@type]}">${topaz.models.ri}</articles>
      <annotations type="${topaz.models.ri[@type]}">${topaz.models.ri}</annotations>
      <users type="http://topazproject.org/models#filter">${topaz.mulgara.baseuri}#filter:model=users</users>
      <grants type="http://topazproject.org/models#filter">${topaz.mulgara.baseuri}#filter:model=grants</grants>
      <revokes type="http://topazproject.org/models#filter">${topaz.mulgara.baseuri}#filter:model=revokes</revokes>
      <pp type="http://topazproject.org/models#filter">${topaz.mulgara.baseuri}#filter:model=pp</pp>
      <preferences type="http://topazproject.org/models#filter">${topaz.mulgara.baseuri}#filter:model=preferences</preferences>
      <profiles type="http://topazproject.org/models#filter">${topaz.mulgara.baseuri}#filter:model=profiles</profiles>
      <ratings type="http://topazproject.org/models#filter">${topaz.mulgara.baseuri}#filter:model=ratings</ratings>
      <alerts type="http://topazproject.org/models#filter">${topaz.mulgara.baseuri}#filter:model=alerts</alerts>
      <criteria type="http://topazproject.org/models#filter">${topaz.mulgara.baseuri}#filter:model=criteria</criteria>
      <str type="http://topazproject.org/models#StringCompare">${topaz.mulgara.baseuri}#str</str>
      <xsd type="http://mulgara.org/mulgara#XMLSchemaModel">${topaz.mulgara.baseuri}#xsd</xsd>
    </models>
    <services>
      <!-- Configuration to talk to Fedora -->
      <fedora>
        <base-url>http://${network.hosts.fedora}:${network.ports.fedora}/fedora/</base-url>
        <uri>${topaz.services.fedora.base-url}services/management</uri>
        <auth-method>BASIC</auth-method>
        <userName>fedoraAdmin</userName>
        <password>fedoraAdmin</password>
      </fedora>
      <fedoraUploader>
        <uri>${topaz.services.fedora.base-url}management/upload</uri>
        <auth-method>${topaz.services.fedora.auth-method}</auth-method>
        <userName>${topaz.services.fedora.userName}</userName>
        <password>${topaz.services.fedora.password}</password>
      </fedoraUploader>

      <!-- Configuration to talk to Mulgara -->
      <itql>
        <uri>http://${network.hosts.mulgara}:${network.ports.mulgara}/mulgara-service/services/ItqlBeanService</uri>
        <auth-method>NONE</auth-method>
      </itql>
      <itql-admin>
        <uri>${topaz.services.itql.uri}</uri>
        <auth-method>NONE</auth-method>
      </itql-admin>
    </services>
    
    <utilities>
      <image-magick>
        <executable-path>/usr/bin/convert</executable-path>
        <identify-path>/usr/bin/identify</identify-path>
        <temp-directory>/tmp</temp-directory>
      </image-magick>
    </utilities>

    <server>
      <!-- Any remaining topaz services (search) are in the plosone container
           TODO: Use of these parameters should be deprecated -->
      <hostname>${network.hosts.plosone}</hostname>
      <https-port>${network.ports.plosone-ssl}</https-port>
    </server>

    <!-- Configuration to talk to CAS -->
    <cas-server>
      <base-url>https://${network.hosts.cas}:${network.ports.cas-ssl}/cas</base-url>
    </cas-server>

    <fedoragsearch>
      <urls>
        <url>http://${network.hosts.plosone}:${network.ports.plosone}/ws-search-webapp/services/FedoraGenericSearchServicePort</url>
      </urls>
      <repository>Topaz</repository>
      <index>TopazIndex</index>
      <indexDocXslt>topazFoxmlToLucene</indexDocXslt>
      <resultPageXslt>copyXml</resultPageXslt>
      <fgsrepository>
        <fedoraSoap>${topaz.services.fedora.base-url}services</fedoraSoap>
        <fedoraUser>${topaz.services.fedora.userName}</fedoraUser>
        <fedoraPass>${topaz.services.fedora.password}</fedoraPass>
      </fgsrepository>
    </fedoragsearch>

    <!-- 
    The pdpName configures the XACML-PDP used by the corresponding XACML-PEP.
    PDPs are configured seperately in a PDPConfig.xml. The default PDPConfig 
    file is in WEB-INF/classes directory. It can be overridden by specifying a 
    -Dcom.sun.xacml.PDPConfigFile=fileName 
    -->
    <articles>
      <pdpName>standard-pdp</pdpName>
    </articles>
    <annotations>
      <pdpName>standard-pdp</pdpName>
    </annotations>
    <replies>
      <pdpName>standard-pdp</pdpName>
    </replies>
    <permissions>
      <pdpName>standard-pdp</pdpName>
    </permissions>
    <profiles>
      <pdpName>standard-pdp</pdpName>
    </profiles>
    <preferences>
      <pdpName>standard-pdp</pdpName>
    </preferences>
    <users>
      <pdpName>standard-pdp</pdpName>
    </users>
    <ratings>
      <pdpName>standard-pdp</pdpName>
    </ratings>
    <alerts>
      <pdpName>standard-pdp</pdpName>
    </alerts>
    <search>
      <pdpName>standard-pdp</pdpName>
    </search>
    <access>
      <pdpName>standard-pdp</pdpName>
    </access>
  </topaz>
</config>

<?xml version="1.0" encoding="UTF-8" ?>
<!--
  This file is a template. It contains many configuration parameters you may want to change.
  However, there are even more configuration parameters that can be tuned. To get a list of
  all of these, see documentation. (Or, failing that, most defaults are configured in the
  plosone webapp at WEB-INF/classes/defaults.xml. Though it is possible that there are
  even more - see ConfigurationStore documentation.)
-->
<config>
  <network>
    <!-- This network section defines the hosts and ports used to talk to the services
         the publishing system uses.

         Note to developers: Please do not use anything from the network section directly
         in code. Instead define something in your own namespace and reference that. Doing
         so allows more flexibility if re-factoring the network topology later.

         With the exception of the "webhead", most services run as web-applications within
         a J2EE container (usually tomcat). Multiple containers can run on the same host
         by listening on different ports. In fact, the default configuration is to run
         each container on different ports regardless so that additional configuration
         change is not required when running containers separately or on the same host.
         The publishing system uses the following web-applications:
          * cas          - Handles user authentication for the publishing system
          * registration - Registers and logs in users (usually runs in the same
                           container that cas runs in.
          * fedora       - The blob store used to store ingested articles
          * mulgara      - The tripple store. (Currently uses axis over http, but will
                           change to run as a stand-alone rmi server in the future)
          * plosone      - The publishing system
          * search       - The lucene full-text search engine. (No configuration in the
                           network section yet. Shares the plosone container.)
          * doi-resolver - Resolves DOIs. (Also no configuration here yet. Shares
                           plosone container.)
          * default      - This is the webhead that runs apache. See wiki for more info.
          * mailhost     - The machine to send mail via. Usually just localhost if a
                           mail server is running.
    -->
    <hosts>
      <!-- Set hosts.default to FQHN (not localhost) if installing all components on one host
           (or to webhead FQHN for multiple host installation) -->
      <default>localhost</default>
      <mailhost>localhost</mailhost>
      <!-- For multibox install, change the following entires to the appropriate FQHNs -->
      <cas>${network.hosts.default}</cas>
      <registration>${network.hosts.cas}</registration>
      <fedora>${network.hosts.default}</fedora>
      <mulgara>${network.hosts.default}</mulgara>
      <plosone>${network.hosts.default}</plosone>
      <!-- TODO: Use registration apropriately every where. Pull out doi-resolver (& search?) -->
    </hosts>
    <ports>
      <!-- There are 4 protocols that the publishing system uses:
            * http    - The default protocol
            * TLS/SSL - When communication needs to be secure
            * RMI     - An java specific RPC protocol (to be uses soon)
            * mail    - The SMTP protocol

          Ports are defined as either "host-protocol" or just "host" if the protocol is http.
          If defining a port that is http, if the value would be 80, leave it blank.
          If defining a port that is https, if the value would be 443, leave it blank.
      -->
      <!-- If using port 80, set default to empty (not 80) -->
      <default>${network.ports.plosone}</default>
      <!-- If using port 443, set cas-ssl to empty -->
      <cas-ssl>7443</cas-ssl>
    </ports>
  </network>

  <pub>
    <app-context></app-context>
    <resource-sub-dir></resource-sub-dir>

    <search>
      <snippetsMax>3</snippetsMax>          <!-- Number of snippets to show per document -->
      <fieldMaxLength>50</fieldMaxLength>   <!-- Max chars per indexed field? -->
      <cacheDuration>600000</cacheDuration> <!-- Milliseconds to cache search results -->
      <pageSize>10</pageSize>               <!-- Number of results per page -->
      <fetchSize>10</fetchSize>             <!-- Number of results to fetch at a time -->
    </search>

    <!-- Stuff used by doi-resolver -->
    <webserver-url>http://${network.hosts.default}:${network.ports.default}${pub.app-context}/</webserver-url>

    <!-- common display constants -->
    <name>Public Library of Science</name>
    <email><general>webmaster@plos.org</general></email>
    <copyright>This work is licensed under a Creative Commons Attribution-Share Alike 3.0 License, http://creativecommons.org/licenses/by-sa/3.0/</copyright>

    <!-- defaults for generating a PLoS ONE Atom Feed -->
    <feed>
      <title>PLoS ONE</title>
      <tagline>Publishing science, accelerating research</tagline>
      <icon>${webserver-url}images/pone_favicon.ico</icon>
      <extended> <!-- Configuration of extended atom feeds -->
        <prefix>plos</prefix> <!-- namespace prefix for custom elements -->
        <namespace>http://www.plos.org/atom/ns#plos</namespace> <!-- custom element namespace -->
      </extended>
      <basePath>/rss/</basePath>              <!-- Path to rss feeds after journal context -->
      <defaultFile></defaultFile>  <!-- Default rss feed if none other specified -->
      <categoryPrefix></categoryPrefix>       <!-- File prefix for a specific category -->
      <defaultName>New Articles</defaultName> <!-- Name of default feed (prefixed by journal) -->
      <defaultDuration>3</defaultDuration>    <!-- Default duraiton in months -->
    </feed>

    <!-- 
      This is used to define which DOI regular expression maps to which URL in the DOI  resolver.
      The rules are applied sequentially from top to bottom and the first matching one will execute.
      If an error is encountered, or the article is not found, it will use the network.hosts.default,
      network.ports.default, and pub.app-context to construct the page not found url.
     -->
    <doi-journals>
      <journal>
        <url>http://www.plosone.org/</url>
        <regex>10\.1371/journal\.pone\.\d{7}</regex>
      </journal>
      <journal>
        <url>http://clinicaltrials.plos.org/</url>
        <regex>10\.1371/journal\.pctr\.\d{7}</regex>
      </journal>
    </doi-journals>

    <spring>
      <!-- crossref information - set parameters and sendToXref to true to turn on -->
      <crossref>
        <plos>
          <doiurl>http://...</doiurl>        <!-- URL where your URIs can be found -->
          <email>webmaster@your-org</email>  <!-- email address to send info to -->
        </plos>
        <login>crossref-username</login>     <!-- crossref login -->
        <password>your-password</password>   <!-- crossref password -->
        <area>test</area>
        <sendToXref>false</sendToXref>       <!-- Set to true to turn on crossref posting -->
      </crossref>
    </spring>
  </pub>

  <plos-registration>
    <!-- It is assumed plos-registartion webapp is running on cas. However that can be changed
         by changing the following settings. -->
    <app-context>/plos-registration</app-context> <!-- Name of expanded webapp -->
  </plos-registration>

  <topaz>
    <services>
      <!-- Configuration to talk to Fedora -->
      <fedora>
        <auth-method>BASIC</auth-method>
        <userName>fedoraAdmin</userName>
        <password>fedoraAdmin</password>
      </fedora>
    </services>

    <utilities>
      <image-magick>
        <executable-path>/usr/bin/convert</executable-path>
        <temp-directory>/tmp</temp-directory>
      </image-magick>
    </utilities>

    <search>
      <!-- Path where lucene search index is stored -->
      <indexpath>/var/lib/topaz/data/lucene</indexpath>
      <!-- Fields of lucene meta data that are searched by default -->
      <defaultfields>description,title,body,creator</defaultfields>
    </search>

  </topaz>
</config>
